<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JYVOS Comptable ‚Äî G√©rez vos finances</title>
<link href="https://fonts.googleapis.com/css2?family=Clash+Display:wght@400;500;600;700&family=Satoshi:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --gold:#c9a84c; --gold2:#f0d080; --gold-dim:rgba(201,168,76,0.12);
  --dark:#080a0e; --dark2:#0f1218; --dark3:#161b24; --surface:#1c2230;
  --surface2:#232b3a; --border:rgba(255,255,255,0.07); --border-gold:rgba(201,168,76,0.2);
  --text:#eef0f5; --muted:#6b7590; --muted2:#4a5268;
  --green:#27ae60; --green-dim:rgba(39,174,96,0.12);
  --red:#e74c3c; --red-dim:rgba(231,76,60,0.12);
  --blue:#2980b9; --blue-dim:rgba(41,128,185,0.12);
  --orange:#e67e22; --orange-dim:rgba(230,126,34,0.12);
  --r:14px;
}
*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;overflow:hidden;}
body{font-family:'Satoshi',sans-serif;background:var(--dark);color:var(--text);display:flex;flex-direction:column;}

/* BG */
.bg{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden;}
.bg-orb{position:absolute;border-radius:50%;filter:blur(80px);opacity:0.08;}
.bg-orb1{width:600px;height:600px;background:var(--gold);top:-200px;left:-200px;}
.bg-orb2{width:400px;height:400px;background:#2980b9;bottom:-100px;right:-100px;}
.bg-grid{position:absolute;inset:0;background-image:linear-gradient(rgba(255,255,255,0.02) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,0.02) 1px,transparent 1px);background-size:48px 48px;}

/* PAGES */
.page{display:none;flex-direction:column;height:100%;position:relative;z-index:1;overflow:hidden;}
.page.active{display:flex;}

/* ===================== LANDING ===================== */
#landing{align-items:center;justify-content:center;padding:20px;overflow-y:auto;}
.landing-wrap{width:100%;max-width:460px;animation:fadeUp .6s ease both;}
@keyframes fadeUp{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}

.brand{display:flex;align-items:center;gap:14px;margin-bottom:40px;justify-content:center;}
.brand-icon{width:56px;height:56px;border-radius:16px;background:linear-gradient(135deg,var(--gold),#7a4e10);display:flex;align-items:center;justify-content:center;font-family:'Clash Display',sans-serif;font-weight:700;font-size:24px;color:#080a0e;box-shadow:0 8px 24px rgba(201,168,76,0.3);}
.brand-name{font-family:'Clash Display',sans-serif;font-size:28px;font-weight:700;letter-spacing:-0.5px;}
.brand-name span{color:var(--gold);}

.tagline{text-align:center;margin-bottom:40px;}
.tagline h1{font-family:'Clash Display',sans-serif;font-size:32px;font-weight:600;line-height:1.2;margin-bottom:10px;}
.tagline h1 em{color:var(--gold);font-style:normal;}
.tagline p{font-size:15px;color:var(--muted);line-height:1.6;}

.landing-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;}
.land-btn{padding:18px 16px;border-radius:var(--r);border:1px solid var(--border);background:var(--dark2);cursor:pointer;transition:all .25s;text-align:center;display:flex;flex-direction:column;align-items:center;gap:8px;}
.land-btn:hover{transform:translateY(-3px);border-color:var(--border-gold);}
.land-btn .icon{font-size:28px;}
.land-btn .label{font-family:'Clash Display',sans-serif;font-size:14px;font-weight:600;}
.land-btn .desc{font-size:11px;color:var(--muted);}
.land-btn.primary{border-color:var(--border-gold);background:var(--gold-dim);}
.land-btn.primary .label{color:var(--gold);}
.land-btn.admin-btn{border-color:rgba(231,76,60,0.2);background:rgba(231,76,60,0.05);}
.land-btn.admin-btn .label{color:#e74c3c;}

.land-full{width:100%;padding:15px;border-radius:var(--r);border:1px solid var(--border);background:var(--dark2);cursor:pointer;transition:all .25s;display:flex;align-items:center;justify-content:center;gap:10px;font-family:'Clash Display',sans-serif;font-size:14px;font-weight:600;color:var(--muted);}
.land-full:hover{border-color:var(--border-gold);color:var(--text);}

/* ===================== AUTH PAGES ===================== */
#register-page,#login-page,#admin-login-page{align-items:center;justify-content:center;padding:20px;overflow-y:auto;}
.auth-card{width:100%;max-width:420px;background:var(--dark2);border:1px solid var(--border);border-radius:20px;padding:36px 32px;animation:fadeUp .4s ease both;}
.auth-back{display:flex;align-items:center;gap:8px;color:var(--muted);font-size:13px;cursor:pointer;margin-bottom:24px;transition:color .2s;}
.auth-back:hover{color:var(--text);}
.auth-title{font-family:'Clash Display',sans-serif;font-size:24px;font-weight:600;margin-bottom:6px;}
.auth-sub{font-size:13px;color:var(--muted);margin-bottom:28px;line-height:1.5;}

.field{margin-bottom:16px;}
.field label{display:block;font-size:12px;color:var(--muted);margin-bottom:7px;font-weight:500;text-transform:uppercase;letter-spacing:.5px;}
.field input,.field select{width:100%;padding:13px 16px;background:var(--dark3);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:14px;font-family:'Satoshi',sans-serif;outline:none;transition:border-color .2s;}
.field input:focus,.field select:focus{border-color:var(--gold);}
.field select{appearance:none;cursor:pointer;}
.field .hint{font-size:11px;color:var(--muted);margin-top:5px;}

.phone-wrap{display:flex;gap:8px;}
.phone-prefix{padding:13px 14px;background:var(--dark3);border:1px solid var(--border);border-radius:10px;color:var(--gold);font-size:14px;font-weight:600;white-space:nowrap;}

.btn-primary{width:100%;padding:14px;border-radius:12px;border:none;background:linear-gradient(135deg,var(--gold),#8b5e1a);color:#080a0e;font-size:15px;font-weight:700;font-family:'Clash Display',sans-serif;cursor:pointer;transition:all .2s;letter-spacing:.3px;}
.btn-primary:hover{opacity:.9;transform:translateY(-1px);box-shadow:0 8px 24px rgba(201,168,76,0.25);}
.btn-secondary{width:100%;padding:13px;border-radius:12px;border:1px solid var(--border);background:transparent;color:var(--muted);font-size:14px;font-family:'Satoshi',sans-serif;cursor:pointer;transition:all .2s;margin-top:10px;}
.btn-secondary:hover{border-color:var(--border-gold);color:var(--text);}

.alert{padding:12px 14px;border-radius:10px;font-size:13px;margin-bottom:14px;display:none;}
.alert.show{display:block;}
.alert-err{background:rgba(231,76,60,.1);border:1px solid rgba(231,76,60,.25);color:#e74c3c;}
.alert-ok{background:rgba(39,174,96,.1);border:1px solid rgba(39,174,96,.25);color:#27ae60;}
.alert-info{background:rgba(201,168,76,.08);border:1px solid rgba(201,168,76,.2);color:var(--gold);}

/* CONFIRM CODE */
.code-boxes{display:flex;gap:10px;justify-content:center;margin:20px 0;}
.code-box{width:46px;height:54px;border-radius:10px;border:2px solid var(--border);background:var(--dark3);color:var(--text);font-size:22px;font-weight:700;text-align:center;outline:none;transition:border-color .2s;font-family:'Clash Display',sans-serif;}
.code-box:focus{border-color:var(--gold);}

/* ===================== APP SHELL ===================== */
#app-page,#admin-page{flex-direction:column;}
.topbar{height:58px;background:var(--dark2);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 18px;flex-shrink:0;z-index:50;}
.tb-left{display:flex;align-items:center;gap:10px;}
.tb-logo{width:32px;height:32px;border-radius:10px;background:linear-gradient(135deg,var(--gold),#7a4e10);display:flex;align-items:center;justify-content:center;font-family:'Clash Display',sans-serif;font-weight:700;font-size:14px;color:#080a0e;}
.tb-title{font-family:'Clash Display',sans-serif;font-size:16px;font-weight:600;}
.tb-badge{padding:3px 10px;border-radius:20px;font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;}
.badge-user{background:var(--blue-dim);color:var(--blue);border:1px solid rgba(41,128,185,.25);}
.badge-admin{background:var(--gold-dim);color:var(--gold);border:1px solid var(--border-gold);}
.tb-right{display:flex;align-items:center;gap:10px;}
.tb-notif{position:relative;cursor:pointer;font-size:18px;}
.notif-dot{position:absolute;top:-2px;right:-2px;width:8px;height:8px;background:var(--red);border-radius:50%;}
.tb-avatar{width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,var(--blue),#1a5276);display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;cursor:pointer;}

/* BOTTOM NAV */
.bottom-nav{height:62px;background:var(--dark2);border-top:1px solid var(--border);display:flex;flex-shrink:0;}
.nav-item{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;cursor:pointer;transition:color .2s;color:var(--muted2);border:none;background:none;}
.nav-item.active{color:var(--gold);}
.nav-item .nav-icon{font-size:20px;}
.nav-item .nav-label{font-size:10px;font-weight:600;letter-spacing:.3px;}

/* CONTENT AREA */
.app-content{flex:1;overflow-y:auto;overflow-x:hidden;}
.tab-content{display:none;padding:18px;animation:fadeUp .3s ease both;}
.tab-content.active{display:block;}

/* ===================== DASHBOARD TAB ===================== */
.welcome-bar{background:linear-gradient(135deg,rgba(201,168,76,.1),rgba(201,168,76,.03));border:1px solid var(--border-gold);border-radius:var(--r);padding:18px;margin-bottom:18px;display:flex;align-items:center;gap:14px;}
.welcome-av{width:44px;height:44px;border-radius:50%;background:linear-gradient(135deg,var(--blue),#1a5276);display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:700;flex-shrink:0;}
.welcome-name{font-family:'Clash Display',sans-serif;font-size:16px;font-weight:600;}
.welcome-sub{font-size:12px;color:var(--muted);}

/* CAPITAL CARD */
.capital-card{background:linear-gradient(135deg,#1a2a1a,#0f1a0f);border:1px solid rgba(39,174,96,.2);border-radius:var(--r);padding:22px;margin-bottom:18px;position:relative;overflow:hidden;}
.capital-card::before{content:'';position:absolute;top:-40px;right:-40px;width:120px;height:120px;background:rgba(39,174,96,.06);border-radius:50%;}
.capital-label{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px;}
.capital-value{font-family:'Clash Display',sans-serif;font-size:36px;font-weight:700;color:var(--green);margin-bottom:12px;}
.capital-currency{font-size:16px;color:var(--muted);}
.capital-row{display:flex;gap:12px;}
.capital-mini{flex:1;background:rgba(0,0,0,.2);border-radius:10px;padding:10px 12px;}
.capital-mini-label{font-size:10px;color:var(--muted);margin-bottom:4px;}
.capital-mini-val{font-family:'Clash Display',sans-serif;font-size:16px;font-weight:600;}

/* CARDS GRID */
.cards2{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:18px;}
.mini-card{background:var(--dark2);border:1px solid var(--border);border-radius:var(--r);padding:16px;transition:transform .2s;}
.mini-card:hover{transform:translateY(-2px);}
.mini-card-icon{font-size:22px;margin-bottom:8px;}
.mini-card-label{font-size:11px;color:var(--muted);margin-bottom:4px;}
.mini-card-val{font-family:'Clash Display',sans-serif;font-size:18px;font-weight:600;}

/* CONSEIL BANNER */
.conseil-banner{background:var(--gold-dim);border:1px solid var(--border-gold);border-radius:var(--r);padding:14px 16px;margin-bottom:18px;display:flex;gap:12px;align-items:flex-start;}
.conseil-icon{font-size:20px;flex-shrink:0;margin-top:1px;}
.conseil-text{font-size:13px;line-height:1.55;color:var(--gold2);}
.conseil-text strong{color:var(--gold);display:block;margin-bottom:3px;font-size:12px;text-transform:uppercase;letter-spacing:.4px;}

/* TRANSACTIONS */
.section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;}
.section-title{font-family:'Clash Display',sans-serif;font-size:15px;font-weight:600;}
.btn-add{padding:7px 14px;border-radius:8px;background:var(--gold-dim);border:1px solid var(--border-gold);color:var(--gold);font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;}
.btn-add:hover{background:rgba(201,168,76,.2);}

.tx-list{display:flex;flex-direction:column;gap:8px;}
.tx-item{background:var(--dark2);border:1px solid var(--border);border-radius:12px;padding:13px 14px;display:flex;align-items:center;gap:12px;transition:background .2s;}
.tx-item:hover{background:var(--dark3);}
.tx-icon{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;}
.tx-icon.in{background:var(--green-dim);}
.tx-icon.out{background:var(--red-dim);}
.tx-desc{flex:1;}
.tx-name{font-size:13px;font-weight:500;margin-bottom:2px;}
.tx-date{font-size:11px;color:var(--muted);}
.tx-amount{font-family:'Clash Display',sans-serif;font-size:15px;font-weight:600;}
.tx-amount.in{color:var(--green);}
.tx-amount.out{color:var(--red);}

/* ABONNEMENT */
.abo-banner{background:linear-gradient(135deg,rgba(230,126,34,.1),rgba(230,126,34,.03));border:1px solid rgba(230,126,34,.25);border-radius:var(--r);padding:16px;margin-bottom:18px;}
.abo-title{font-family:'Clash Display',sans-serif;font-size:14px;font-weight:600;color:var(--orange);margin-bottom:6px;}
.abo-text{font-size:12px;color:var(--muted);line-height:1.5;margin-bottom:12px;}
.abo-om{background:rgba(0,0,0,.3);border-radius:10px;padding:10px 12px;font-size:13px;}
.abo-om span{color:var(--gold);font-weight:600;}
.btn-abo{margin-top:10px;padding:10px 18px;border-radius:10px;background:var(--orange-dim);border:1px solid rgba(230,126,34,.3);color:var(--orange);font-size:13px;font-weight:600;cursor:pointer;width:100%;font-family:'Clash Display',sans-serif;}

/* ===================== ADD TX MODAL ===================== */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:200;display:none;align-items:flex-end;justify-content:center;}
.modal-overlay.open{display:flex;}
.modal-sheet{background:var(--dark2);border-radius:20px 20px 0 0;padding:24px 20px 32px;width:100%;max-width:500px;animation:slideUp .3s ease both;border-top:1px solid var(--border);}
@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.modal-handle{width:36px;height:4px;background:var(--border);border-radius:2px;margin:0 auto 20px;}
.modal-title{font-family:'Clash Display',sans-serif;font-size:18px;font-weight:600;margin-bottom:20px;}
.type-toggle{display:flex;gap:8px;margin-bottom:16px;}
.type-btn{flex:1;padding:10px;border-radius:10px;border:1px solid var(--border);background:transparent;color:var(--muted);font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;font-family:'Satoshi',sans-serif;}
.type-btn.active-in{background:var(--green-dim);border-color:rgba(39,174,96,.3);color:var(--green);}
.type-btn.active-out{background:var(--red-dim);border-color:rgba(231,76,60,.3);color:var(--red);}

/* ===================== MESSAGES TAB ===================== */
.msg-list{display:flex;flex-direction:column;gap:8px;}
.msg-thread{background:var(--dark2);border:1px solid var(--border);border-radius:12px;padding:13px 14px;display:flex;gap:12px;align-items:center;cursor:pointer;transition:all .2s;}
.msg-thread:hover{border-color:var(--border-gold);}
.msg-av{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:700;flex-shrink:0;}
.msg-av-admin{background:linear-gradient(135deg,var(--gold),#7a4e10);color:#080a0e;}
.msg-av-sys{background:var(--blue-dim);color:var(--blue);border:1px solid rgba(41,128,185,.2);}
.msg-info{flex:1;min-width:0;}
.msg-name{font-size:13px;font-weight:600;margin-bottom:3px;}
.msg-preview{font-size:12px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.msg-meta{display:flex;flex-direction:column;align-items:flex-end;gap:4px;}
.msg-time{font-size:10px;color:var(--muted);}
.msg-unread{width:18px;height:18px;background:var(--gold);border-radius:50%;font-size:10px;font-weight:700;display:flex;align-items:center;justify-content:center;color:#080a0e;}

/* CHAT VIEW */
.chat-view{display:none;flex-direction:column;height:100%;}
.chat-view.open{display:flex;}
.chat-header{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px;background:var(--dark2);flex-shrink:0;}
.chat-back{font-size:18px;cursor:pointer;color:var(--muted);}
.chat-header-info{flex:1;}
.chat-header-name{font-family:'Clash Display',sans-serif;font-size:15px;font-weight:600;}
.chat-header-status{font-size:11px;color:var(--green);}
.chat-enc{font-size:10px;color:var(--muted);padding:3px 8px;background:var(--dark3);border-radius:20px;display:flex;align-items:center;gap:4px;}
.chat-messages{flex:1;overflow-y:auto;padding:14px;display:flex;flex-direction:column;gap:10px;}
.msg-bubble{max-width:78%;padding:11px 14px;border-radius:14px;font-size:13px;line-height:1.5;}
.msg-bubble.sent{background:linear-gradient(135deg,rgba(201,168,76,.2),rgba(201,168,76,.1));border:1px solid var(--border-gold);align-self:flex-end;border-bottom-right-radius:4px;}
.msg-bubble.recv{background:var(--dark3);border:1px solid var(--border);align-self:flex-start;border-bottom-left-radius:4px;}
.msg-bubble .btime{font-size:10px;color:var(--muted);margin-top:5px;text-align:right;}
.msg-bubble.recv .btime{text-align:left;}
.chat-input-wrap{padding:12px 14px;border-top:1px solid var(--border);display:flex;gap:10px;background:var(--dark2);flex-shrink:0;}
.chat-input{flex:1;padding:12px 14px;background:var(--dark3);border:1px solid var(--border);border-radius:24px;color:var(--text);font-size:14px;font-family:'Satoshi',sans-serif;outline:none;transition:border-color .2s;}
.chat-input:focus{border-color:var(--gold);}
.chat-send{width:42px;height:42px;border-radius:50%;background:linear-gradient(135deg,var(--gold),#8b5e1a);border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:16px;transition:opacity .2s;}
.chat-send:hover{opacity:.85;}

/* ===================== FINANCES TAB ===================== */
.fin-section{margin-bottom:22px;}
.progress-bar-wrap{background:var(--dark3);border-radius:8px;height:10px;overflow:hidden;margin-top:8px;}
.progress-bar{height:100%;border-radius:8px;transition:width .8s ease;}
.fin-row{display:flex;justify-content:space-between;align-items:center;padding:11px 0;border-bottom:1px solid var(--border);}
.fin-row:last-child{border-bottom:none;}
.fin-row-label{font-size:13px;color:var(--muted);}
.fin-row-val{font-family:'Clash Display',sans-serif;font-size:14px;font-weight:600;}

/* ADMIN */
.admin-nav{display:flex;gap:8px;overflow-x:auto;padding:0 18px 0;margin-bottom:0;scrollbar-width:none;flex-shrink:0;border-bottom:1px solid var(--border);background:var(--dark2);}
.admin-nav::-webkit-scrollbar{display:none;}
.admin-tab{padding:14px 16px;font-size:13px;font-weight:600;cursor:pointer;white-space:nowrap;color:var(--muted);border-bottom:2px solid transparent;transition:all .2s;font-family:'Clash Display',sans-serif;}
.admin-tab.active{color:var(--gold);border-bottom-color:var(--gold);}

.user-card-admin{background:var(--dark2);border:1px solid var(--border);border-radius:var(--r);padding:16px;margin-bottom:10px;transition:border-color .2s;}
.user-card-admin:hover{border-color:var(--border-gold);}
.uca-top{display:flex;align-items:center;gap:12px;margin-bottom:12px;}
.uca-av{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,var(--blue),#1a5276);display:flex;align-items:center;justify-content:center;font-size:15px;font-weight:700;flex-shrink:0;}
.uca-name{font-size:14px;font-weight:600;}
.uca-phone{font-size:12px;color:var(--muted);}
.uca-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;}
.uca-stat{background:var(--dark3);border-radius:8px;padding:8px 10px;text-align:center;}
.uca-stat-label{font-size:10px;color:var(--muted);margin-bottom:3px;}
.uca-stat-val{font-family:'Clash Display',sans-serif;font-size:13px;font-weight:600;}
.btn-msg-user{margin-top:10px;width:100%;padding:9px;border-radius:9px;background:var(--blue-dim);border:1px solid rgba(41,128,185,.25);color:var(--blue);font-size:13px;font-weight:600;cursor:pointer;font-family:'Clash Display',sans-serif;}

/* TOAST */
.toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%) translateY(20px);z-index:500;background:var(--dark2);border:1px solid var(--border);border-radius:12px;padding:12px 20px;font-size:13px;font-weight:500;box-shadow:0 8px 30px rgba(0,0,0,.4);opacity:0;transition:all .4s cubic-bezier(.34,1.56,.64,1);white-space:nowrap;}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}
.toast.t-ok{border-color:rgba(39,174,96,.3);color:var(--green);}
.toast.t-info{border-color:var(--border-gold);color:var(--gold);}
.toast.t-err{border-color:rgba(231,76,60,.3);color:var(--red);}

/* MISC */
.divider{height:1px;background:var(--border);margin:16px 0;}
.empty-state{text-align:center;padding:32px 20px;color:var(--muted);font-size:13px;}
.empty-state .ei{font-size:36px;margin-bottom:10px;}

@media(max-width:400px){
  .auth-card{padding:28px 20px;}
  .capital-value{font-size:28px;}
  .cards2{grid-template-columns:1fr 1fr;}
}
</style>
</head>
<body>
<div class="bg"><div class="bg-orb bg-orb1"></div><div class="bg-orb bg-orb2"></div><div class="bg-grid"></div></div>

<!-- ======================================================
     LANDING
====================================================== -->
<div class="page active" id="landing">
  <div class="landing-wrap">
    <div class="brand">
      <div class="brand-icon">J</div>
      <div class="brand-name">JYVOS <span>Comptable</span></div>
    </div>
    <div class="tagline">
      <h1>G√©rez vos finances,<br><em>boostez vos profits</em> üí∞</h1>
      <p>Plateforme de gestion financi√®re professionnelle pour les entrepreneurs et commer√ßants africains.</p>
    </div>
    <div class="landing-grid">
      <button class="land-btn primary" onclick="goTo('register-page')">
        <span class="icon">‚úçÔ∏è</span>
        <span class="label">Inscription</span>
        <span class="desc">Cr√©er un compte</span>
      </button>
      <button class="land-btn" onclick="goTo('login-page')">
        <span class="icon">üîë</span>
        <span class="label">Connexion</span>
        <span class="desc">Se connecter</span>
      </button>
      <button class="land-btn" onclick="showForgot()">
        <span class="icon">üîí</span>
        <span class="label">Mot de passe</span>
        <span class="desc">R√©cup√©rer</span>
      </button>
      <button class="land-btn admin-btn" onclick="goTo('admin-login-page')">
        <span class="icon">üõ°Ô∏è</span>
        <span class="label">Administrateur</span>
        <span class="desc">Acc√®s restreint</span>
      </button>
    </div>
    <button class="land-full" onclick="goTo('login-page')">
      üì± Connexion rapide par t√©l√©phone
    </button>
    <p style="text-align:center;font-size:11px;color:var(--muted2);margin-top:16px">Abonnement 500 FCFA/mois ¬∑ Orange Money</p>
  </div>
</div>

<!-- ======================================================
     INSCRIPTION
====================================================== -->
<div class="page" id="register-page">
  <div style="overflow-y:auto;flex:1;display:flex;align-items:center;justify-content:center;padding:20px;">
  <div class="auth-card">
    <div class="auth-back" onclick="goTo('landing')">‚Üê Retour</div>
    <div class="auth-title">Cr√©er un compte üéâ</div>
    <div class="auth-sub">Inscrivez-vous avec votre num√©ro de t√©l√©phone et commencez √† g√©rer vos finances.</div>

    <div id="reg-step1">
      <div class="alert alert-err" id="reg-err"></div>
      <div class="field">
        <label>Nom complet</label>
        <input type="text" id="reg-name" placeholder="Ex: Jean Pascal Ngah">
      </div>
      <div class="field">
        <label>Num√©ro de t√©l√©phone</label>
        <div class="phone-wrap">
          <div class="phone-prefix">üá®üá≤ +237</div>
          <input type="tel" id="reg-phone" placeholder="6XX XXX XXX" maxlength="9">
        </div>
        <div class="hint">Un code de confirmation vous sera envoy√©</div>
      </div>
      <div class="field">
        <label>Type de commerce</label>
        <select id="reg-type">
          <option value="">S√©lectionner...</option>
          <option>Commerce g√©n√©ral</option>
          <option>Restaurant / Alimentation</option>
          <option>Boutique v√™tements</option>
          <option>Pharmacie / Sant√©</option>
          <option>Agriculture / √âlevage</option>
          <option>Services / Prestation</option>
          <option>Autre</option>
        </select>
      </div>
      <div class="field">
        <label>Capital de d√©part (FCFA)</label>
        <input type="number" id="reg-capital" placeholder="Ex: 150000">
      </div>
      <div class="field">
        <label>Mot de passe</label>
        <input type="password" id="reg-pass" placeholder="Minimum 6 caract√®res">
      </div>
      <div class="field">
        <label>Confirmer le mot de passe</label>
        <input type="password" id="reg-pass2" placeholder="R√©p√©tez le mot de passe">
      </div>
      <button class="btn-primary" onclick="sendCode()">üì≤ Recevoir le code de confirmation</button>
      <button class="btn-secondary" onclick="goTo('login-page')">D√©j√† inscrit ? Se connecter</button>
    </div>

    <div id="reg-step2" style="display:none">
      <div class="alert alert-info show">üì± Un code de 4 chiffres a √©t√© envoy√© au <strong id="phone-display"></strong></div>
      <p style="font-size:13px;color:var(--muted);margin-bottom:16px;line-height:1.5">Entrez le code re√ßu pour confirmer votre inscription :</p>
      <div class="code-boxes">
        <input class="code-box" maxlength="1" id="c1" oninput="nextCode(this,'c2')">
        <input class="code-box" maxlength="1" id="c2" oninput="nextCode(this,'c3')">
        <input class="code-box" maxlength="1" id="c3" oninput="nextCode(this,'c4')">
        <input class="code-box" maxlength="1" id="c4" oninput="nextCode(this,null)">
      </div>
      <div class="alert alert-err" id="code-err"></div>
      <button class="btn-primary" onclick="verifyCode()">‚úÖ Confirmer l'inscription</button>
      <button class="btn-secondary" onclick="resendCode()">üîÑ Renvoyer le code</button>
      <p style="text-align:center;font-size:11px;color:var(--muted2);margin-top:10px">Code de d√©mo : <strong style="color:var(--gold)">1234</strong></p>
    </div>
  </div>
  </div>
</div>

<!-- ======================================================
     CONNEXION
====================================================== -->
<div class="page" id="login-page">
  <div style="overflow-y:auto;flex:1;display:flex;align-items:center;justify-content:center;padding:20px;">
  <div class="auth-card">
    <div class="auth-back" onclick="goTo('landing')">‚Üê Retour</div>
    <div class="auth-title">Connexion üîë</div>
    <div class="auth-sub">Acc√©dez √† votre espace de gestion financi√®re.</div>
    <div class="alert alert-err" id="login-err"></div>
    <div class="field">
      <label>Num√©ro de t√©l√©phone</label>
      <div class="phone-wrap">
        <div class="phone-prefix">üá®üá≤ +237</div>
        <input type="tel" id="login-phone" placeholder="6XX XXX XXX" maxlength="9">
      </div>
    </div>
    <div class="field">
      <label>Mot de passe</label>
      <input type="password" id="login-pass" placeholder="Votre mot de passe">
    </div>
    <button class="btn-primary" onclick="doLogin()">Se connecter ‚Üí</button>
    <button class="btn-secondary" onclick="goTo('register-page')">Pas encore de compte ? S'inscrire</button>
    <p style="text-align:center;font-size:12px;color:var(--muted);margin-top:12px;cursor:pointer" onclick="showForgot()">Mot de passe oubli√© ?</p>
    <div class="divider"></div>
    <p style="font-size:11px;color:var(--muted2);text-align:center">üß™ D√©mo : t√©l√©phone <strong style="color:var(--gold)">690000001</strong> / mdp <strong style="color:var(--gold)">demo123</strong></p>
  </div>
  </div>
</div>

<!-- ======================================================
     ADMIN LOGIN
====================================================== -->
<div class="page" id="admin-login-page">
  <div style="overflow-y:auto;flex:1;display:flex;align-items:center;justify-content:center;padding:20px;">
  <div class="auth-card" style="border-color:rgba(231,76,60,.2);">
    <div class="auth-back" onclick="goTo('landing')">‚Üê Retour</div>
    <div style="text-align:center;margin-bottom:20px;">
      <div style="font-size:40px;margin-bottom:8px;">üõ°Ô∏è</div>
      <div class="auth-title">Acc√®s Administrateur</div>
      <div class="auth-sub">Zone hautement s√©curis√©e. Acc√®s r√©serv√© exclusivement √† l'administrateur JYVOS.</div>
    </div>
    <div class="alert alert-err" id="admin-err"></div>
    <div class="field">
      <label>Identifiant Admin</label>
      <input type="text" id="admin-id" placeholder="Identifiant confidentiel" autocomplete="off">
    </div>
    <div class="field">
      <label>Mot de passe Admin</label>
      <input type="password" id="admin-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
    </div>
    <div class="field">
      <label>Code de s√©curit√© (6 chiffres)</label>
      <input type="password" id="admin-code" placeholder="Code secret" maxlength="6">
    </div>
    <button class="btn-primary" style="background:linear-gradient(135deg,#e74c3c,#7b1a1a);color:#fff;" onclick="doAdminLogin()">üîê Acc√®s s√©curis√©</button>
    <p style="text-align:center;font-size:11px;color:var(--muted2);margin-top:14px">Toute tentative non autoris√©e est enregistr√©e</p>
  </div>
  </div>
</div>

<!-- ======================================================
     USER APP
====================================================== -->
<div class="page" id="app-page">
  <div class="topbar">
    <div class="tb-left">
      <div class="tb-logo">J</div>
      <div class="tb-title">JYVOS</div>
      <span class="tb-badge badge-user">Mon compte</span>
    </div>
    <div class="tb-right">
      <div class="tb-notif" onclick="openChat('support')">üîî<div class="notif-dot" id="notif-dot"></div></div>
      <div class="tb-avatar" id="user-av">JP</div>
      <button style="background:none;border:none;color:var(--muted);font-size:13px;cursor:pointer;" onclick="logout()">‚¨Ö</button>
    </div>
  </div>

  <div class="app-content">
    <!-- DASHBOARD -->
    <div class="tab-content active" id="tab-dashboard">
      <div class="welcome-bar">
        <div class="welcome-av" id="dash-av">JP</div>
        <div>
          <div class="welcome-name" id="dash-name">Jean Pascal</div>
          <div class="welcome-sub" id="dash-sub">Commerce g√©n√©ral ¬∑ Membre actif</div>
        </div>
      </div>

      <div class="capital-card">
        <div class="capital-label">üí∞ Capital actuel</div>
        <div class="capital-value"><span id="capital-display">0</span> <span class="capital-currency">FCFA</span></div>
        <div class="capital-row">
          <div class="capital-mini">
            <div class="capital-mini-label">üìà B√©n√©fices</div>
            <div class="capital-mini-val" id="benef-display" style="color:var(--green)">0 FCFA</div>
          </div>
          <div class="capital-mini">
            <div class="capital-mini-label">üìâ Pertes</div>
            <div class="capital-mini-val" id="perte-display" style="color:var(--red)">0 FCFA</div>
          </div>
        </div>
      </div>

      <div class="cards2">
        <div class="mini-card">
          <div class="mini-card-icon">üí≥</div>
          <div class="mini-card-label">Entr√©es totales</div>
          <div class="mini-card-val" id="entrees-display" style="color:var(--green)">0</div>
        </div>
        <div class="mini-card">
          <div class="mini-card-icon">üí∏</div>
          <div class="mini-card-label">Sorties totales</div>
          <div class="mini-card-val" id="sorties-display" style="color:var(--red)">0</div>
        </div>
        <div class="mini-card">
          <div class="mini-card-icon">üè¶</div>
          <div class="mini-card-label">√âpargne</div>
          <div class="mini-card-val" id="epargne-display" style="color:var(--blue)">0</div>
        </div>
        <div class="mini-card">
          <div class="mini-card-icon">üìã</div>
          <div class="mini-card-label">Pr√™ts en cours</div>
          <div class="mini-card-val" id="pret-display" style="color:var(--orange)">0</div>
        </div>
      </div>

      <div class="conseil-banner" id="conseil-banner">
        <div class="conseil-icon">üí°</div>
        <div class="conseil-text">
          <strong>Conseil JYVOS</strong>
          <span id="conseil-text">Bienvenue ! Commencez par enregistrer vos transactions pour voir vos b√©n√©fices et pertes en temps r√©el.</span>
        </div>
      </div>

      <div class="abo-banner" id="abo-banner">
        <div class="abo-title">‚ö†Ô∏è Abonnement mensuel ‚Äî 500 FCFA</div>
        <div class="abo-text">Pour continuer √† profiter de JYVOS Comptable, r√©glez votre abonnement mensuel via Orange Money.</div>
        <div class="abo-om">Orange Money : <span>691 928 061</span> ‚Äî Nom : <span>NGAH Ntsama</span></div>
        <button class="btn-abo" onclick="confirmPaiement()">‚úÖ J'ai effectu√© le paiement</button>
      </div>

      <div class="section-header">
        <div class="section-title">Transactions r√©centes</div>
        <button class="btn-add" onclick="openAddTx()">+ Ajouter</button>
      </div>
      <div class="tx-list" id="tx-list">
        <div class="empty-state"><div class="ei">üì≠</div>Aucune transaction encore.<br>Appuyez sur "+ Ajouter" pour commencer.</div>
      </div>
    </div>

    <!-- FINANCES -->
    <div class="tab-content" id="tab-finances">
      <div class="section-title" style="margin-bottom:16px">üìä Analyse financi√®re</div>

      <div class="fin-section">
        <div class="section-header">
          <div class="section-title" style="font-size:14px">Bilan Capital</div>
        </div>
        <div class="fin-row"><span class="fin-row-label">Capital initial</span><span class="fin-row-val" id="f-capital">0 FCFA</span></div>
        <div class="fin-row"><span class="fin-row-label">+ Entr√©es</span><span class="fin-row-val" style="color:var(--green)" id="f-in">0 FCFA</span></div>
        <div class="fin-row"><span class="fin-row-label">‚àí Sorties</span><span class="fin-row-val" style="color:var(--red)" id="f-out">0 FCFA</span></div>
        <div class="fin-row"><span class="fin-row-label">= Capital actuel</span><span class="fin-row-val" id="f-now">0 FCFA</span></div>
        <div class="fin-row"><span class="fin-row-label">B√©n√©fices nets</span><span class="fin-row-val" style="color:var(--green)" id="f-benef">0 FCFA</span></div>
        <div class="fin-row"><span class="fin-row-label">Pertes nettes</span><span class="fin-row-val" style="color:var(--red)" id="f-perte">0 FCFA</span></div>
      </div>

      <div class="fin-section">
        <div class="section-title" style="font-size:14px;margin-bottom:12px">üè¶ √âpargne</div>
        <div style="display:flex;justify-content:space-between;margin-bottom:8px;font-size:13px;">
          <span style="color:var(--muted)">Montant √©pargn√©</span>
          <span style="color:var(--blue);font-weight:600" id="f-epargne">0 FCFA</span>
        </div>
        <div class="progress-bar-wrap"><div class="progress-bar" id="epargne-bar" style="width:0%;background:var(--blue)"></div></div>
        <div style="font-size:11px;color:var(--muted);margin-top:6px" id="epargne-pct">0% du capital</div>
      </div>

      <div class="fin-section">
        <div class="section-title" style="font-size:14px;margin-bottom:12px">üìã Pr√™ts</div>
        <div class="fin-row"><span class="fin-row-label">Pr√™ts re√ßus</span><span class="fin-row-val" style="color:var(--orange)" id="f-pret-in">0 FCFA</span></div>
        <div class="fin-row"><span class="fin-row-label">Pr√™ts rembours√©s</span><span class="fin-row-val" style="color:var(--green)" id="f-pret-out">0 FCFA</span></div>
        <div class="fin-row"><span class="fin-row-label">Solde pr√™ts</span><span class="fin-row-val" style="color:var(--orange)" id="f-pret-solde">0 FCFA</span></div>
      </div>

      <div class="conseil-banner">
        <div class="conseil-icon">üìä</div>
        <div class="conseil-text">
          <strong>Analyse</strong>
          <span id="analyse-text">Ajoutez des transactions pour voir votre analyse financi√®re compl√®te.</span>
        </div>
      </div>
    </div>

    <!-- MESSAGES -->
    <div class="tab-content" id="tab-messages">
      <div id="msg-list-view">
        <div class="section-title" style="margin-bottom:16px">üí¨ Messages</div>
        <div class="msg-list">
          <div class="msg-thread" onclick="openChat('support')">
            <div class="msg-av msg-av-admin">üõ°Ô∏è</div>
            <div class="msg-info">
              <div class="msg-name">Assistance JYVOS</div>
              <div class="msg-preview" id="support-preview">Bienvenue sur JYVOS ! Comment puis-je vous aider ?</div>
            </div>
            <div class="msg-meta">
              <div class="msg-time" id="support-time">Maintenant</div>
              <div class="msg-unread" id="support-unread">1</div>
            </div>
          </div>
          <div class="msg-thread" onclick="openChat('system')">
            <div class="msg-av msg-av-sys">‚öôÔ∏è</div>
            <div class="msg-info">
              <div class="msg-name">Notifications syst√®me</div>
              <div class="msg-preview" id="sys-preview">Votre compte a √©t√© cr√©√© avec succ√®s !</div>
            </div>
            <div class="msg-meta">
              <div class="msg-time">Aujourd'hui</div>
            </div>
          </div>
        </div>
        <div style="margin-top:16px;background:var(--dark2);border:1px solid var(--border);border-radius:12px;padding:12px 14px;display:flex;align-items:center;gap:10px;">
          <span style="font-size:14px">üîí</span>
          <span style="font-size:12px;color:var(--muted)">Tous vos messages sont <strong style="color:var(--text)">chiffr√©s de bout en bout</strong></span>
        </div>
      </div>

      <!-- CHAT VIEW -->
      <div class="chat-view" id="chat-view-support" style="height:calc(100vh - 180px)">
        <div class="chat-header">
          <div class="chat-back" onclick="closeChat('support')">‚Üê</div>
          <div class="msg-av msg-av-admin" style="width:36px;height:36px;font-size:14px;">üõ°Ô∏è</div>
          <div class="chat-header-info">
            <div class="chat-header-name">Assistance JYVOS</div>
            <div class="chat-header-status">‚óè En ligne</div>
          </div>
          <div class="chat-enc">üîí Chiffr√©</div>
        </div>
        <div class="chat-messages" id="chat-msgs-support"></div>
        <div class="chat-input-wrap">
          <input class="chat-input" id="chat-input-support" placeholder="√âcrire un message..." onkeydown="if(event.key==='Enter')sendMsg('support')">
          <button class="chat-send" onclick="sendMsg('support')">‚û§</button>
        </div>
      </div>

      <div class="chat-view" id="chat-view-system" style="height:calc(100vh - 180px)">
        <div class="chat-header">
          <div class="chat-back" onclick="closeChat('system')">‚Üê</div>
          <div class="msg-av msg-av-sys" style="width:36px;height:36px;font-size:14px;">‚öôÔ∏è</div>
          <div class="chat-header-info">
            <div class="chat-header-name">Notifications syst√®me</div>
            <div class="chat-header-status">Automatique</div>
          </div>
          <div class="chat-enc">üîí Chiffr√©</div>
        </div>
        <div class="chat-messages" id="chat-msgs-system">
          <div class="msg-bubble recv">‚úÖ Votre compte a √©t√© cr√©√© avec succ√®s. Bienvenue sur JYVOS Comptable !<div class="btime">Aujourd'hui</div></div>
          <div class="msg-bubble recv">üì± Votre abonnement mensuel de 500 FCFA est d√ª. Payez via Orange Money au 691 928 061.<div class="btime">Aujourd'hui</div></div>
        </div>
        <div class="chat-input-wrap">
          <input class="chat-input" placeholder="Notifications automatiques uniquement" disabled>
        </div>
      </div>
    </div>

    <!-- PROFIL -->
    <div class="tab-content" id="tab-profil">
      <div class="section-title" style="margin-bottom:16px">üë§ Mon profil</div>
      <div style="background:var(--dark2);border:1px solid var(--border);border-radius:var(--r);padding:20px;margin-bottom:14px;">
        <div style="display:flex;align-items:center;gap:14px;margin-bottom:16px;">
          <div class="tb-avatar" style="width:54px;height:54px;font-size:20px;" id="profil-av">JP</div>
          <div>
            <div style="font-family:'Clash Display',sans-serif;font-size:18px;font-weight:600;" id="profil-name">Jean Pascal</div>
            <div style="font-size:13px;color:var(--muted);" id="profil-phone">+237 690 000 001</div>
          </div>
        </div>
        <div class="fin-row"><span class="fin-row-label">Type de commerce</span><span class="fin-row-val" id="profil-type">Commerce g√©n√©ral</span></div>
        <div class="fin-row"><span class="fin-row-label">Membre depuis</span><span class="fin-row-val">F√©vrier 2026</span></div>
        <div class="fin-row"><span class="fin-row-label">Statut abonnement</span><span class="fin-row-val" style="color:var(--green)">‚úÖ Actif</span></div>
      </div>

      <div class="abo-banner">
        <div class="abo-title">üí≥ Renouveler l'abonnement</div>
        <div class="abo-text">Votre abonnement mensuel JYVOS est de <strong>500 FCFA/mois</strong>.</div>
        <div class="abo-om">Orange Money : <span>691 928 061</span><br>Nom : <span>NGAH Ntsama</span></div>
        <button class="btn-abo" onclick="confirmPaiement()">‚úÖ Confirmer le paiement</button>
      </div>

      <button style="width:100%;padding:13px;border-radius:12px;background:var(--red-dim);border:1px solid rgba(231,76,60,.25);color:var(--red);font-size:14px;font-weight:600;cursor:pointer;font-family:'Clash Display',sans-serif;" onclick="logout()">
        üö™ D√©connexion
      </button>
    </div>
  </div>

  <!-- BOTTOM NAV -->
  <div class="bottom-nav">
    <button class="nav-item active" id="nav-dashboard" onclick="switchTab('dashboard')">
      <span class="nav-icon">üè†</span><span class="nav-label">Accueil</span>
    </button>
    <button class="nav-item" id="nav-finances" onclick="switchTab('finances')">
      <span class="nav-icon">üìä</span><span class="nav-label">Finances</span>
    </button>
    <button class="nav-item" id="nav-messages" onclick="switchTab('messages')">
      <span class="nav-icon">üí¨</span><span class="nav-label">Messages</span>
    </button>
    <button class="nav-item" id="nav-profil" onclick="switchTab('profil')">
      <span class="nav-icon">üë§</span><span class="nav-label">Profil</span>
    </button>
  </div>
</div>

<!-- ======================================================
     ADD TRANSACTION MODAL
====================================================== -->
<div class="modal-overlay" id="tx-modal">
  <div class="modal-sheet">
    <div class="modal-handle"></div>
    <div class="modal-title">Nouvelle transaction</div>
    <div class="type-toggle">
      <button class="type-btn active-in" id="type-in" onclick="setTxType('in')">üíö Entr√©e d'argent</button>
      <button class="type-btn" id="type-out" onclick="setTxType('out')">üî¥ Sortie d'argent</button>
    </div>
    <div class="type-toggle" id="type-special-row">
      <button class="type-btn" id="type-epargne" onclick="setTxType('epargne')">üíô √âpargne</button>
      <button class="type-btn" id="type-pret" onclick="setTxType('pret')">üü† Pr√™t</button>
    </div>
    <div class="field">
      <label>Description</label>
      <input type="text" id="tx-desc" placeholder="Ex: Vente de produits, achat stock...">
    </div>
    <div class="field">
      <label>Montant (FCFA)</label>
      <input type="number" id="tx-amount" placeholder="Ex: 25000">
    </div>
    <div class="field">
      <label>Cat√©gorie</label>
      <select id="tx-cat">
        <option>Vente / Revenu</option>
        <option>Achat / Stock</option>
        <option>Salaire / Employ√©</option>
        <option>Transport / Livraison</option>
        <option>Loyer / Charges</option>
        <option>Remboursement</option>
        <option>Autre</option>
      </select>
    </div>
    <button class="btn-primary" onclick="addTransaction()">‚úÖ Enregistrer</button>
    <button class="btn-secondary" onclick="closeTxModal()">Annuler</button>
  </div>
</div>

<!-- ======================================================
     ADMIN PANEL
====================================================== -->
<div class="page" id="admin-page">
  <div class="topbar">
    <div class="tb-left">
      <div class="tb-logo">J</div>
      <div class="tb-title">JYVOS Admin</div>
      <span class="tb-badge badge-admin">üõ°Ô∏è Admin</span>
    </div>
    <div class="tb-right">
      <div class="tb-avatar" style="background:linear-gradient(135deg,var(--gold),#7a4e10);color:#080a0e;">SA</div>
      <button style="background:none;border:none;color:var(--muted);font-size:13px;cursor:pointer;" onclick="logout()">‚¨Ö</button>
    </div>
  </div>

  <div class="admin-nav" id="admin-nav">
    <div class="admin-tab active" onclick="switchAdminTab('users')">üë• Utilisateurs</div>
    <div class="admin-tab" onclick="switchAdminTab('finances')">üí∞ Finances</div>
    <div class="admin-tab" onclick="switchAdminTab('messages')">üí¨ Messages</div>
    <div class="admin-tab" onclick="switchAdminTab('securite')">üõ°Ô∏è S√©curit√©</div>
  </div>

  <div class="app-content">
    <!-- USERS -->
    <div class="tab-content active" id="admin-tab-users" style="padding:16px;">
      <div class="section-header">
        <div class="section-title">Comptes utilisateurs (<span id="user-count">1</span>)</div>
      </div>
      <div id="admin-users-list"></div>
    </div>

    <!-- FINANCES ADMIN -->
    <div class="tab-content" id="admin-tab-finances" style="padding:16px;">
      <div class="section-title" style="margin-bottom:16px">üí∞ Vue financi√®re globale</div>
      <div class="cards2" style="margin-bottom:18px;">
        <div class="mini-card"><div class="mini-card-icon">üë•</div><div class="mini-card-label">Utilisateurs</div><div class="mini-card-val" id="adm-total-users">1</div></div>
        <div class="mini-card"><div class="mini-card-icon">üí≥</div><div class="mini-card-label">Abonnements</div><div class="mini-card-val" style="color:var(--green)" id="adm-abo">500 FCFA</div></div>
        <div class="mini-card"><div class="mini-card-icon">üìà</div><div class="mini-card-label">Capital total</div><div class="mini-card-val" style="color:var(--gold)" id="adm-capital">0 FCFA</div></div>
        <div class="mini-card"><div class="mini-card-icon">üè¶</div><div class="mini-card-label">√âpargnes totales</div><div class="mini-card-val" style="color:var(--blue)" id="adm-epargne">0 FCFA</div></div>
      </div>
      <div id="admin-finances-detail"></div>
    </div>

    <!-- MESSAGES ADMIN -->
    <div class="tab-content" id="admin-tab-messages" style="padding:0;">
      <div id="admin-msg-list-view" style="padding:16px;">
        <div class="section-title" style="margin-bottom:14px">Conversations avec les utilisateurs</div>
        <div id="admin-convos-list"></div>
      </div>
      <div class="chat-view" id="admin-chat-view" style="height:calc(100vh - 170px)">
        <div class="chat-header">
          <div class="chat-back" onclick="closeAdminChat()">‚Üê</div>
          <div class="tb-avatar" style="width:36px;height:36px;font-size:14px;" id="admin-chat-av">U</div>
          <div class="chat-header-info">
            <div class="chat-header-name" id="admin-chat-name">Utilisateur</div>
            <div class="chat-header-status">Chat priv√© chiffr√©</div>
          </div>
          <div class="chat-enc">üîí E2E</div>
        </div>
        <div class="chat-messages" id="admin-chat-msgs"></div>
        <div class="chat-input-wrap">
          <input class="chat-input" id="admin-chat-input" placeholder="R√©pondre √† l'utilisateur..." onkeydown="if(event.key==='Enter')adminSendMsg()">
          <button class="chat-send" onclick="adminSendMsg()">‚û§</button>
        </div>
      </div>
    </div>

    <!-- SECURITE -->
    <div class="tab-content" id="admin-tab-securite" style="padding:16px;">
      <div class="section-title" style="margin-bottom:16px">üõ°Ô∏è S√©curit√© & Param√®tres</div>
      <div style="background:var(--dark2);border:1px solid var(--border-gold);border-radius:var(--r);padding:20px;">
        <div class="fin-row"><span class="fin-row-label">Chiffrement E2E actif</span><span style="color:var(--green);font-size:14px">‚úÖ Activ√©</span></div>
        <div class="fin-row"><span class="fin-row-label">Double authentification</span><span style="color:var(--green);font-size:14px">‚úÖ Activ√©</span></div>
        <div class="fin-row"><span class="fin-row-label">Journaux d'audit</span><span style="color:var(--green);font-size:14px">‚úÖ Actif</span></div>
        <div class="fin-row"><span class="fin-row-label">Sessions chiffr√©es</span><span style="color:var(--green);font-size:14px">‚úÖ HTTPS</span></div>
        <div class="fin-row"><span class="fin-row-label">Acc√®s admin masqu√©</span><span style="color:var(--green);font-size:14px">‚úÖ Restreint</span></div>
        <div class="fin-row"><span class="fin-row-label">Tentatives de connexion</span><span style="color:var(--muted);font-size:14px" id="login-attempts">0 tentative(s)</span></div>
      </div>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast">Message</div>

<script>
// ============================================================
// STATE
// ============================================================
var DB = {
  users: [
    { id:'demo', name:'Jean Pascal Ngah', phone:'690000001', pass:'demo123', type:'Commerce g√©n√©ral', capital:150000, transactions:[], epargne:0, pretIn:0, pretOut:0, messages:[], abo:true }
  ],
  currentUser: null,
  adminMessages: {},  // keyed by user id
  txType: 'in',
  adminAttempts: 0
};

var ADMIN_CREDS = { id:'jyvosadmin', pass:'Admin@JYVOS2026!', code:'982761' };

var CONSEILS = [
  "üí° Conseil : √âpargnez au moins 10% de chaque b√©n√©fice pour constituer une r√©serve de s√©curit√©.",
  "üìä Analyse : Vos sorties d√©passent vos entr√©es ce mois. R√©duisez vos d√©penses non essentielles.",
  "üöÄ Astuce : Suivez vos stocks de pr√®s pour √©viter les ruptures qui font perdre des ventes.",
  "üí∞ Tip : Diversifiez vos sources de revenus pour r√©duire les risques financiers.",
  "üìà Strat√©gie : R√©investissez 30% de vos b√©n√©fices pour faire cro√Ætre votre capital.",
  "üè¶ √âpargne : Avec votre √©pargne actuelle, vous pourrez couvrir vos charges pendant plusieurs semaines.",
  "‚ö†Ô∏è Attention : Vos pr√™ts en cours n√©cessitent un suivi r√©gulier pour √©viter les retards.",
  "‚úÖ Bravo : Votre capital a augment√© ! Continuez √† enregistrer toutes vos transactions."
];

// ============================================================
// NAVIGATION
// ============================================================
function goTo(pageId) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(pageId).classList.add('active');
}

function logout() {
  DB.currentUser = null;
  goTo('landing');
}

function showForgot() {
  showToast('üì± Envoi du lien de r√©initialisation par SMS...','t-info');
  setTimeout(()=>showToast('‚úÖ SMS envoy√© ! V√©rifiez votre t√©l√©phone.','t-ok'),1500);
}

// ============================================================
// REGISTER
// ============================================================
var regData = {};
var genCode = '';

function sendCode() {
  var name = document.getElementById('reg-name').value.trim();
  var phone = document.getElementById('reg-phone').value.trim();
  var type = document.getElementById('reg-type').value;
  var capital = parseInt(document.getElementById('reg-capital').value)||0;
  var pass = document.getElementById('reg-pass').value;
  var pass2 = document.getElementById('reg-pass2').value;
  var err = document.getElementById('reg-err');

  err.classList.remove('show');

  if (!name||name.length<3){ showErr(err,'Entrez votre nom complet'); return; }
  if (!phone||phone.length<8){ showErr(err,'Num√©ro de t√©l√©phone invalide'); return; }
  if (!type){ showErr(err,'S√©lectionnez votre type de commerce'); return; }
  if (capital<=0){ showErr(err,'Entrez votre capital de d√©part'); return; }
  if (pass.length<6){ showErr(err,'Le mot de passe doit avoir au moins 6 caract√®res'); return; }
  if (pass!==pass2){ showErr(err,'Les mots de passe ne correspondent pas'); return; }
  if (DB.users.find(u=>u.phone===phone)){ showErr(err,'Ce num√©ro est d√©j√† inscrit'); return; }

  regData = {name,phone,type,capital,pass};
  genCode = '1234'; // demo fixed code
  document.getElementById('phone-display').textContent = '+237 '+phone;
  document.getElementById('reg-step1').style.display='none';
  document.getElementById('reg-step2').style.display='block';
  showToast('üì≤ Code envoy√© au +237 '+phone,'t-info');
}

function nextCode(el,nextId) {
  if(el.value&&nextId) document.getElementById(nextId).focus();
}

function verifyCode() {
  var entered = ['c1','c2','c3','c4'].map(id=>document.getElementById(id).value).join('');
  var err = document.getElementById('code-err');
  err.classList.remove('show');
  if(entered!==genCode){ showErr(err,'Code incorrect. R√©essayez. (D√©mo: 1234)'); return; }

  var newUser = {
    id: 'u_'+Date.now(),
    name: regData.name,
    phone: regData.phone,
    pass: regData.pass,
    type: regData.type,
    capital: regData.capital,
    transactions: [],
    epargne: 0, pretIn:0, pretOut:0,
    messages:[{from:'system',text:'üéâ Compte cr√©√© avec succ√®s ! Bienvenue sur JYVOS Comptable.',time:now()}],
    abo: false,
    createdAt: new Date().toLocaleDateString('fr-FR')
  };
  DB.users.push(newUser);
  DB.currentUser = newUser;
  DB.adminMessages[newUser.id] = [];

  // Init support msg
  newUser.messages = [
    {from:'admin',text:'Bienvenue sur JYVOS ! üëã Je suis votre assistant financier. Comment puis-je vous aider ?',time:now()}
  ];

  initUserApp();
  showToast('üéâ Compte cr√©√© avec succ√®s !','t-ok');
  setTimeout(()=>goTo('app-page'),500);
}

function resendCode() {
  showToast('üì≤ Code renvoy√© !','t-info');
}

function showErr(el,msg) { el.textContent=msg; el.classList.add('show'); }

// ============================================================
// LOGIN
// ============================================================
function doLogin() {
  var phone = document.getElementById('login-phone').value.trim();
  var pass = document.getElementById('login-pass').value;
  var err = document.getElementById('login-err');
  err.classList.remove('show');

  var user = DB.users.find(u=>u.phone===phone&&u.pass===pass);
  if(!user){ showErr(err,'Num√©ro ou mot de passe incorrect'); return; }

  DB.currentUser = user;
  if(!DB.adminMessages[user.id]) DB.adminMessages[user.id]=[];
  initUserApp();
  goTo('app-page');
}

function doAdminLogin() {
  var id = document.getElementById('admin-id').value.trim();
  var pass = document.getElementById('admin-pass').value;
  var code = document.getElementById('admin-code').value.trim();
  var err = document.getElementById('admin-err');
  err.classList.remove('show');

  DB.adminAttempts++;
  document.getElementById('login-attempts').textContent = DB.adminAttempts+' tentative(s)';

  if(id===ADMIN_CREDS.id && pass===ADMIN_CREDS.pass && code===ADMIN_CREDS.code){
    initAdminPanel();
    goTo('admin-page');
    showToast('üõ°Ô∏è Acc√®s administrateur accord√©','t-ok');
  } else {
    showErr(err,'Identifiants incorrects. Acc√®s refus√©.');
    showToast('‚õî Tentative √©chou√©e ‚Äî enregistr√©e','t-err');
  }
}

// ============================================================
// USER APP
// ============================================================
function initUserApp() {
  var u = DB.currentUser;
  var initials = u.name.split(' ').map(n=>n[0]).join('').slice(0,2).toUpperCase();
  ['user-av','dash-av','profil-av'].forEach(id=>{ var el=document.getElementById(id); if(el) el.textContent=initials; });
  document.getElementById('dash-name').textContent = u.name.split(' ')[0];
  document.getElementById('dash-sub').textContent = u.type+' ¬∑ '+(u.abo?'Abonnement actif':'Abonnement requis');
  document.getElementById('profil-name').textContent = u.name;
  document.getElementById('profil-phone').textContent = '+237 '+u.phone;
  document.getElementById('profil-type').textContent = u.type;
  document.getElementById('abo-banner').style.display = u.abo ? 'none':'block';
  renderTransactions();
  updateFinances();
  loadSupportChat();
  updateConseil();
}

function switchTab(tab) {
  ['dashboard','finances','messages','profil'].forEach(t=>{
    document.getElementById('tab-'+t).classList.remove('active');
    document.getElementById('nav-'+t).classList.remove('active');
  });
  document.getElementById('tab-'+tab).classList.add('active');
  document.getElementById('nav-'+tab).classList.add('active');
  if(tab==='messages'){
    // close any open chat
    document.getElementById('msg-list-view').style.display='block';
    document.querySelectorAll('.chat-view').forEach(c=>c.classList.remove('open'));
  }
}

// ============================================================
// TRANSACTIONS
// ============================================================
function setTxType(t) {
  DB.txType = t;
  ['in','out','epargne','pret'].forEach(type=>{
    var btn = document.getElementById('type-'+type);
    if(!btn) return;
    btn.className='type-btn';
    if(type===t){
      if(t==='in') btn.className='type-btn active-in';
      else if(t==='out') btn.className='type-btn active-out';
      else if(t==='epargne') btn.className='type-btn';btn.style.background=t==='epargne'?'var(--blue-dim)':t==='pret'?'var(--orange-dim)':'';
      btn.style.borderColor = t==='epargne'?'rgba(41,128,185,.3)':t==='pret'?'rgba(230,126,34,.3)':'';
      btn.style.color = t==='epargne'?'var(--blue)':t==='pret'?'var(--orange)':'';
    } else { btn.style.background=''; btn.style.borderColor=''; btn.style.color=''; }
  });
}

function openAddTx() { document.getElementById('tx-modal').classList.add('open'); }
function closeTxModal() { document.getElementById('tx-modal').classList.remove('open'); }

function addTransaction() {
  var desc = document.getElementById('tx-desc').value.trim();
  var amount = parseInt(document.getElementById('tx-amount').value)||0;
  var cat = document.getElementById('tx-cat').value;
  var type = DB.txType;

  if(!desc){ showToast('Entrez une description','t-err'); return; }
  if(amount<=0){ showToast('Entrez un montant valide','t-err'); return; }

  var tx = { desc, amount, cat, type, date:new Date().toLocaleDateString('fr-FR'), time:now() };
  DB.currentUser.transactions.unshift(tx);

  // update capital
  if(type==='in') DB.currentUser.capital += amount;
  else if(type==='out') DB.currentUser.capital -= amount;
  else if(type==='epargne'){ DB.currentUser.epargne += amount; DB.currentUser.capital -= amount; }
  else if(type==='pret'){ DB.currentUser.pretIn += amount; DB.currentUser.capital += amount; }

  renderTransactions();
  updateFinances();
  updateConseil();
  closeTxModal();
  document.getElementById('tx-desc').value='';
  document.getElementById('tx-amount').value='';
  setTxType('in');
  showToast('‚úÖ Transaction enregistr√©e !','t-ok');
}

function renderTransactions() {
  var u = DB.currentUser;
  var el = document.getElementById('tx-list');
  if(!u.transactions.length){
    el.innerHTML='<div class="empty-state"><div class="ei">üì≠</div>Aucune transaction encore.<br>Appuyez sur "+ Ajouter" pour commencer.</div>';
    return;
  }
  el.innerHTML = u.transactions.slice(0,10).map(tx=>{
    var isIn = tx.type==='in'||tx.type==='pret';
    var icon = tx.type==='in'?'üíö':tx.type==='out'?'üî¥':tx.type==='epargne'?'üíô':'üü†';
    var sign = isIn?'+':'-';
    var cls = isIn?'in':'out';
    return `<div class="tx-item">
      <div class="tx-icon ${cls}">${icon}</div>
      <div class="tx-desc"><div class="tx-name">${tx.desc}</div><div class="tx-date">${tx.cat} ¬∑ ${tx.date}</div></div>
      <div class="tx-amount ${cls}">${sign}${fmt(tx.amount)}</div>
    </div>`;
  }).join('');
}

function updateFinances() {
  var u = DB.currentUser;
  var totalIn = u.transactions.filter(t=>t.type==='in').reduce((s,t)=>s+t.amount,0);
  var totalOut = u.transactions.filter(t=>t.type==='out').reduce((s,t)=>s+t.amount,0);
  var benef = totalIn > totalOut ? totalIn - totalOut : 0;
  var perte = totalOut > totalIn ? totalOut - totalIn : 0;
  var capitalInit = parseFloat(localStorage.getItem('capital_'+u.id)||u.capital)||u.capital;

  set('capital-display', fmt(u.capital));
  set('benef-display', fmt(benef)+' FCFA');
  set('perte-display', fmt(perte)+' FCFA');
  set('entrees-display', fmt(totalIn)+' FCFA');
  set('sorties-display', fmt(totalOut)+' FCFA');
  set('epargne-display', fmt(u.epargne)+' FCFA');
  set('pret-display', fmt(u.pretIn)+' FCFA');

  // Finances tab
  set('f-capital', fmt(capitalInit)+' FCFA');
  set('f-in', '+'+fmt(totalIn)+' FCFA');
  set('f-out', '-'+fmt(totalOut)+' FCFA');
  set('f-now', fmt(u.capital)+' FCFA');
  set('f-benef', fmt(benef)+' FCFA');
  set('f-perte', fmt(perte)+' FCFA');
  set('f-epargne', fmt(u.epargne)+' FCFA');
  set('f-pret-in', fmt(u.pretIn)+' FCFA');
  set('f-pret-out', fmt(u.pretOut)+' FCFA');
  set('f-pret-solde', fmt(u.pretIn-u.pretOut)+' FCFA');

  var pct = u.capital>0 ? Math.min(100,Math.round(u.epargne/u.capital*100)) : 0;
  document.getElementById('epargne-bar').style.width=pct+'%';
  set('epargne-pct', pct+'% du capital actuel');

  // Analysis text
  var analysis = benef>0 ? 'üìà Votre entreprise est b√©n√©ficiaire ce mois. F√©licitations ! Pensez √† √©pargner une partie.'
    : perte>0 ? '‚ö†Ô∏è Vos sorties d√©passent vos entr√©es. Analysez vos d√©penses et trouvez comment augmenter vos revenus.'
    : 'Enregistrez vos transactions pour voir votre analyse financi√®re.';
  set('analyse-text', analysis);
}

function updateConseil() {
  var u = DB.currentUser;
  var totalIn = u.transactions.filter(t=>t.type==='in').reduce((s,t)=>s+t.amount,0);
  var totalOut = u.transactions.filter(t=>t.type==='out').reduce((s,t)=>s+t.amount,0);
  var idx = 0;
  if(u.transactions.length===0) idx=0;
  else if(totalOut>totalIn) idx=1;
  else if(u.epargne>0) idx=5;
  else idx = Math.floor(Math.random()*CONSEILS.length);
  set('conseil-text', CONSEILS[idx].replace(/^üí° Conseil : |^üìä Analyse : |^üöÄ Astuce : |^üí∞ Tip : |^üìà Strat√©gie : |^üè¶ √âpargne : |^‚ö†Ô∏è Attention : |^‚úÖ Bravo : /,''));
}

function confirmPaiement() {
  DB.currentUser.abo = true;
  document.getElementById('abo-banner').style.display='none';
  showToast('‚úÖ Paiement confirm√© ! Abonnement actif.','t-ok');
  // System msg
  DB.currentUser.messages.push({from:'system',text:'‚úÖ Abonnement mensuel confirm√©. Merci pour votre paiement !',time:now()});
}

// ============================================================
// MESSAGES / CHAT
// ============================================================
function loadSupportChat() {
  var u = DB.currentUser;
  var el = document.getElementById('chat-msgs-support');
  el.innerHTML='';
  u.messages.forEach(m=>{
    el.innerHTML += `<div class="msg-bubble ${m.from==='user'?'sent':'recv'}">${m.text}<div class="btime">${m.time}</div></div>`;
  });
  el.scrollTop=el.scrollHeight;
}

function openChat(type) {
  document.getElementById('msg-list-view').style.display='none';
  document.getElementById('chat-view-'+type).classList.add('open');
  if(type==='support'){
    document.getElementById('support-unread').style.display='none';
    document.getElementById('notif-dot').style.display='none';
    loadSupportChat();
  }
}

function closeChat(type) {
  document.getElementById('chat-view-'+type).classList.remove('open');
  document.getElementById('msg-list-view').style.display='block';
}

function sendMsg(type) {
  var inp = document.getElementById('chat-input-'+type);
  var text = inp.value.trim();
  if(!text) return;
  var u = DB.currentUser;
  u.messages.push({from:'user',text,time:now()});
  inp.value='';
  loadSupportChat();

  // Sync to admin
  if(!DB.adminMessages[u.id]) DB.adminMessages[u.id]=[];
  DB.adminMessages[u.id].push({from:'user',name:u.name,text,time:now()});

  // Auto reply after 1.5s
  setTimeout(()=>{
    var replies = [
      'Merci pour votre message ! Un de nos agents va vous r√©pondre dans les plus brefs d√©lais.',
      'Nous avons bien re√ßu votre demande. Pouvez-vous nous donner plus de d√©tails ?',
      'Votre question est bien not√©e. Voici quelques conseils : assurez-vous d\'enregistrer toutes vos transactions quotidiennement.',
      'Pour toute question sur votre abonnement, vous pouvez payer via Orange Money au 691 928 061.'
    ];
    var reply = replies[Math.floor(Math.random()*replies.length)];
    u.messages.push({from:'admin',text:reply,time:now()});
    DB.adminMessages[u.id].push({from:'admin',text:reply,time:now()});
    loadSupportChat();
    document.getElementById('support-preview').textContent=reply;
    document.getElementById('support-time').textContent='Maintenant';
  },1500);
}

// ============================================================
// ADMIN PANEL
// ============================================================
function initAdminPanel() {
  switchAdminTab('users');
}

function switchAdminTab(tab) {
  ['users','finances','messages','securite'].forEach(t=>{
    document.getElementById('admin-tab-'+t).classList.remove('active');
  });
  document.getElementById('admin-tab-'+tab).classList.add('active');
  document.querySelectorAll('.admin-tab').forEach((el,i)=>{
    el.classList.remove('active');
    if(['users','finances','messages','securite'][i]===tab) el.classList.add('active');
  });
  if(tab==='users') renderAdminUsers();
  else if(tab==='finances') renderAdminFinances();
  else if(tab==='messages') renderAdminMessages();

  // close admin chat
  document.getElementById('admin-msg-list-view').style.display='block';
  document.getElementById('admin-chat-view').classList.remove('open');
}

function renderAdminUsers() {
  var el = document.getElementById('admin-users-list');
  document.getElementById('user-count').textContent = DB.users.length;
  el.innerHTML = DB.users.map(u=>{
    var totalIn = u.transactions.filter(t=>t.type==='in').reduce((s,t)=>s+t.amount,0);
    var totalOut = u.transactions.filter(t=>t.type==='out').reduce((s,t)=>s+t.amount,0);
    var init = u.name.split(' ').map(n=>n[0]).join('').slice(0,2).toUpperCase();
    return `<div class="user-card-admin">
      <div class="uca-top">
        <div class="uca-av">${init}</div>
        <div>
          <div class="uca-name">${u.name}</div>
          <div class="uca-phone">+237 ${u.phone} ¬∑ ${u.type}</div>
        </div>
        <div style="margin-left:auto;font-size:12px;padding:4px 10px;border-radius:20px;background:${u.abo?'var(--green-dim)':'var(--red-dim)'};color:${u.abo?'var(--green)':'var(--red)'};">${u.abo?'‚úÖ Abonn√©':'‚ùå Non pay√©'}</div>
      </div>
      <div class="uca-stats">
        <div class="uca-stat"><div class="uca-stat-label">Capital</div><div class="uca-stat-val" style="color:var(--gold)">${fmt(u.capital)}</div></div>
        <div class="uca-stat"><div class="uca-stat-label">Entr√©es</div><div class="uca-stat-val" style="color:var(--green)">+${fmt(totalIn)}</div></div>
        <div class="uca-stat"><div class="uca-stat-label">Sorties</div><div class="uca-stat-val" style="color:var(--red)">-${fmt(totalOut)}</div></div>
      </div>
      <button class="btn-msg-user" onclick="openAdminChat('${u.id}')">üí¨ Envoyer un message</button>
    </div>`;
  }).join('');
}

function renderAdminFinances() {
  var totalCapital = DB.users.reduce((s,u)=>s+u.capital,0);
  var totalEpargne = DB.users.reduce((s,u)=>s+u.epargne,0);
  document.getElementById('adm-total-users').textContent = DB.users.length;
  document.getElementById('adm-abo').textContent = (DB.users.filter(u=>u.abo).length*500)+' FCFA';
  document.getElementById('adm-capital').textContent = fmt(totalCapital)+' FCFA';
  document.getElementById('adm-epargne').textContent = fmt(totalEpargne)+' FCFA';

  var el = document.getElementById('admin-finances-detail');
  el.innerHTML = DB.users.map(u=>{
    var totalIn = u.transactions.filter(t=>t.type==='in').reduce((s,t)=>s+t.amount,0);
    var totalOut = u.transactions.filter(t=>t.type==='out').reduce((s,t)=>s+t.amount,0);
    var benef = totalIn>totalOut?totalIn-totalOut:0;
    var perte = totalOut>totalIn?totalOut-totalIn:0;
    return `<div style="background:var(--dark2);border:1px solid var(--border);border-radius:var(--r);padding:16px;margin-bottom:10px;">
      <div style="font-family:'Clash Display',sans-serif;font-size:14px;font-weight:600;margin-bottom:12px;">${u.name}</div>
      <div class="fin-row"><span class="fin-row-label">Capital actuel</span><span class="fin-row-val" style="color:var(--gold)">${fmt(u.capital)} FCFA</span></div>
      <div class="fin-row"><span class="fin-row-label">Entr√©es totales</span><span class="fin-row-val" style="color:var(--green)">+${fmt(totalIn)} FCFA</span></div>
      <div class="fin-row"><span class="fin-row-label">Sorties totales</span><span class="fin-row-val" style="color:var(--red)">-${fmt(totalOut)} FCFA</span></div>
      <div class="fin-row"><span class="fin-row-label">B√©n√©fices</span><span class="fin-row-val" style="color:var(--green)">${fmt(benef)} FCFA</span></div>
      <div class="fin-row"><span class="fin-row-label">Pertes</span><span class="fin-row-val" style="color:var(--red)">${fmt(perte)} FCFA</span></div>
      <div class="fin-row"><span class="fin-row-label">√âpargne</span><span class="fin-row-val" style="color:var(--blue)">${fmt(u.epargne)} FCFA</span></div>
    </div>`;
  }).join('');
}

function renderAdminMessages() {
  var el = document.getElementById('admin-convos-list');
  if(!DB.users.length){ el.innerHTML='<div class="empty-state"><div class="ei">üí¨</div>Aucun utilisateur.</div>'; return; }
  el.innerHTML = DB.users.map(u=>{
    var msgs = DB.adminMessages[u.id]||[];
    var last = msgs.length?msgs[msgs.length-1].text:'Aucun message';
    var init = u.name.split(' ').map(n=>n[0]).join('').slice(0,2).toUpperCase();
    return `<div class="msg-thread" onclick="openAdminChat('${u.id}')">
      <div class="msg-av" style="background:linear-gradient(135deg,var(--blue),#1a5276);color:#fff;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;">${init}</div>
      <div class="msg-info">
        <div class="msg-name">${u.name}</div>
        <div class="msg-preview">${last.slice(0,50)}${last.length>50?'...':''}</div>
      </div>
      <div class="msg-meta"><div class="msg-time">${msgs.length?msgs[msgs.length-1].time:'‚Äî'}</div></div>
    </div>`;
  }).join('');
}

var adminChatUserId = null;

function openAdminChat(userId) {
  adminChatUserId = userId;
  var u = DB.users.find(u=>u.id===userId);
  var init = u.name.split(' ').map(n=>n[0]).join('').slice(0,2).toUpperCase();
  document.getElementById('admin-chat-av').textContent = init;
  document.getElementById('admin-chat-name').textContent = u.name;

  document.getElementById('admin-msg-list-view').style.display='none';
  document.getElementById('admin-chat-view').classList.add('open');
  loadAdminChatMsgs();
}

function closeAdminChat() {
  document.getElementById('admin-chat-view').classList.remove('open');
  document.getElementById('admin-msg-list-view').style.display='block';
  renderAdminMessages();
}

function loadAdminChatMsgs() {
  var msgs = DB.adminMessages[adminChatUserId]||[];
  var el = document.getElementById('admin-chat-msgs');
  if(!msgs.length){ el.innerHTML='<div class="empty-state"><div class="ei">üí¨</div>Aucun message. D√©marrez la conversation.</div>'; return; }
  el.innerHTML = msgs.map(m=>{
    var sent = m.from==='admin';
    return `<div class="msg-bubble ${sent?'sent':'recv'}">${m.text}<div class="btime">${m.time}</div></div>`;
  }).join('');
  el.scrollTop=el.scrollHeight;
}

function adminSendMsg() {
  var inp = document.getElementById('admin-chat-input');
  var text = inp.value.trim();
  if(!text||!adminChatUserId) return;
  if(!DB.adminMessages[adminChatUserId]) DB.adminMessages[adminChatUserId]=[];
  var msg = {from:'admin',text,time:now()};
  DB.adminMessages[adminChatUserId].push(msg);
  inp.value='';
  loadAdminChatMsgs();

  // Also deliver to user if they're the current user
  var u = DB.users.find(u=>u.id===adminChatUserId);
  if(u){
    u.messages.push({from:'admin',text,time:now()});
    // update preview
    if(DB.currentUser&&DB.currentUser.id===adminChatUserId){
      document.getElementById('support-preview').textContent=text;
      document.getElementById('notif-dot').style.display='block';
      document.getElementById('support-unread').style.display='flex';
      loadSupportChat();
    }
  }
  showToast('‚úÖ Message envoy√©','t-ok');
}

// ============================================================
// HELPERS
// ============================================================
function set(id,val){ var el=document.getElementById(id); if(el) el.textContent=val; }
function fmt(n){ return Number(n).toLocaleString('fr-FR'); }
function now(){ return new Date().toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit'}); }
function showToast(msg,cls){
  var t=document.getElementById('toast');
  t.textContent=msg; t.className='toast '+(cls||'t-ok');
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),3000);
}

// Close modal on overlay click
document.getElementById('tx-modal').addEventListener('click',function(e){ if(e.target===this) closeTxModal(); });
</script>
</body>
</html>
